import { Controller } from "@hotwired/stimulus"

// Connects to data-controller="mfe"
export default class extends Controller {
  static values = { 
    name: String,
    container: String 
  }

  connect() {
    console.log(`ðŸ”µ MFE Controller connected: ${this.nameValue}`)
    
    // Ensure the MFE is properly mounted when stimulus connects
    this.ensureMounted()
  }

  disconnect() {
    console.log(`ðŸ”µ MFE Controller disconnected: ${this.nameValue}`)
  }

  ensureMounted() {
    if (window.miniSPA && window.miniSPA.started) {
      setTimeout(() => {
        console.log(`ðŸ”µ Ensuring ${this.nameValue} is mounted`)
        window.miniSPA.evaluateApps()
      }, 50)
    }
  }

  refresh() {
    console.log(`ðŸ”µ Refreshing MFE: ${this.nameValue}`)
    this.ensureMounted()
  }
}
