<% unless authenticated? %>
  <%= link_to "Log in", new_session_path %>
<% end %>

<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
  <h1 style="text-align: center; color: #333; margin-bottom: 30px;">TaskTracker with Single-SPA</h1>
  
  <% if authenticated? %>
    <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
      <h2>Welcome, <%= Current.user.email_address %></h2>
      <p>Organization: <%= Current.user.organization&.name || "No organization assigned" %></p>
    </div>
  <% end %>

  

  <% if authenticated? %>
    <!-- TaskList Microfrontend Container -->
    <div id="tasklist-mfe-container">
      <div style="text-align: center; color: #666; padding: 40px;">
        Loading TaskList Microfrontend...
      </div>
    </div>

    <!-- Make tasks and users data available globally for the microfrontend -->
    <script>
      window.tasksData = <%= raw @tasks.to_json %>;
      window.usersData = <%= raw @users.to_json %>;
      console.log('ðŸ”µ Tasks data loaded for microfrontends:', {
        tasks: window.tasksData.length,
        users: window.usersData.length
      });
    </script>

    <!-- Original React TaskList (for comparison) -->
    <div style="margin-top: 30px; padding: 20px; background: #fff; border: 1px solid #ddd; border-radius: 8px;">
      <h3>Original Rails Embedded TaskList (for comparison)</h3>
      <div id="react-task-list"></div>
      
      <script type="module">
        import React from "react"
        import { createRoot } from "react-dom/client"
        import TaskList from "components/TaskList"

        const tasks = <%= raw @tasks.to_json %>
        const users = <%= raw @users.to_json %>  
        const container = document.getElementById('react-task-list')
        
        if (container) {
          const root = createRoot(container)
          root.render(React.createElement(TaskList, { 
            tasks: tasks, 
            users: users    
          }))
        }
      </script>
    </div>
  <% end %>
</div>